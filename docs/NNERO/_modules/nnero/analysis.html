

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nnero.analysis &mdash; NNERO 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=7026087e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            NNERO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/tutorial.html">Introduction to the Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">nnero</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NNERO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">nnero.analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for nnero.analysis</h1><div class="highlight"><pre>
<span></span><span class="c1">##################################################################################</span>
<span class="c1"># This file is part of NNERO.</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2024, Ga√©tan Facchinetti</span>
<span class="c1">#</span>
<span class="c1"># NNERO is free software: you can redistribute it and/or modify it </span>
<span class="c1"># under the terms of the GNU General Public License as published by </span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or any </span>
<span class="c1"># later version. NNERO is distributed in the hope that it will be useful, </span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. </span>
<span class="c1"># See the GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU </span>
<span class="c1"># General Public License along with NNERO. </span>
<span class="c1"># If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1">##################################################################################</span>

<span class="c1">##################</span>
<span class="c1">#</span>
<span class="c1"># Definition of some functions to analyse chains and plot them</span>
<span class="c1">#</span>
<span class="c1">##################</span>



<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span><span class="p">,</span> <span class="n">gaussian_filter1d</span>


<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="kn">from</span> <span class="nn">.data</span>         <span class="kn">import</span> <span class="n">MP_KEY_CORRESPONDANCE</span>
<span class="kn">from</span> <span class="nn">.predictor</span>    <span class="kn">import</span> <span class="n">DEFAULT_VALUES</span>
<span class="kn">from</span> <span class="nn">.regressor</span>    <span class="kn">import</span> <span class="n">Regressor</span>
<span class="kn">from</span> <span class="nn">.classifier</span>   <span class="kn">import</span> <span class="n">Classifier</span>
<span class="kn">from</span> <span class="nn">.interpolator</span> <span class="kn">import</span> <span class="n">Interpolator</span>
<span class="kn">from</span> <span class="nn">.predictor</span>    <span class="kn">import</span> <span class="n">predict_Xe_numpy</span><span class="p">,</span> <span class="n">predict_tau_numpy</span><span class="p">,</span> <span class="n">predict_parameter_numpy</span>


<span class="n">EMCEE_IMPORTED</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">emcee</span>
    <span class="n">EMCEE_IMPORTED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="neutrino_masses">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.neutrino_masses">[docs]</a>
<span class="k">def</span> <span class="nf">neutrino_masses</span><span class="p">(</span><span class="n">mnu_1</span><span class="p">,</span> <span class="n">mnu_2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mnu_3</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="s1">&#39;NORMAL&#39;</span><span class="p">):</span>

    <span class="c1">## DEFINE NEUTRINO MASSES BEFORE ANYTHING ELSE</span>
    <span class="n">delta_m21_2</span> <span class="o">=</span> <span class="mf">7.5e-5</span>
    <span class="n">delta_m31_NO_2</span> <span class="o">=</span> <span class="mf">2.55e-3</span>
    <span class="n">delta_m31_IO_2</span> <span class="o">=</span> <span class="mf">2.45e-3</span>
    

    <span class="c1"># degenerate neutrino masses (all equal to the first one)</span>
    <span class="k">if</span> <span class="n">hierarchy</span> <span class="o">==</span> <span class="s1">&#39;DEGENERATE&#39;</span><span class="p">:</span>
        <span class="n">mnu_2</span> <span class="o">=</span> <span class="n">mnu_1</span>
        <span class="n">mnu_3</span> <span class="o">=</span> <span class="n">mnu_1</span>

    <span class="c1"># normal ordering</span>
    <span class="k">if</span> <span class="n">hierarchy</span> <span class="o">==</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">:</span>
        <span class="n">mnu_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mnu_1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta_m21_2</span><span class="p">)</span> 
        <span class="n">mnu_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mnu_1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta_m31_NO_2</span><span class="p">)</span>

    <span class="c1"># inverse ordering</span>
    <span class="k">if</span> <span class="n">hierarchy</span> <span class="o">==</span> <span class="s2">&quot;INVERSE&quot;</span><span class="p">:</span>
        <span class="n">mnu_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mnu_1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta_m31_IO_2</span><span class="p">)</span> 
        <span class="n">mnu_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mnu_1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta_m31_IO_2</span> <span class="o">+</span> <span class="n">delta_m21_2</span><span class="p">)</span>

    <span class="c1"># create an array of neutrino masses</span>
    <span class="n">m_neutrinos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mnu_1</span><span class="p">,</span> <span class="n">mnu_2</span><span class="p">,</span> <span class="n">mnu_3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">m_neutrinos</span></div>



<div class="viewcode-block" id="to_CLASS_names">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.to_CLASS_names">[docs]</a>
<span class="k">def</span> <span class="nf">to_CLASS_names</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">is_array</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

    <span class="n">labels_correspondance</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span> <span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">MP_KEY_CORRESPONDANCE</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>    
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels_correspondance</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">labels_correspondance</span> <span class="k">else</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">array</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_array</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">array</span></div>

    

<div class="viewcode-block" id="to_21cmFAST_names">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.to_21cmFAST_names">[docs]</a>
<span class="k">def</span> <span class="nf">to_21cmFAST_names</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

    <span class="n">is_array</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">MP_KEY_CORRESPONDANCE</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">MP_KEY_CORRESPONDANCE</span> <span class="k">else</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">array</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_array</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">array</span></div>


<span class="c1">#################################################</span>
<span class="c1">## CHAIN ANALYSIS TOOLS</span>


<div class="viewcode-block" id="MPChain">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPChain">[docs]</a>
<span class="k">class</span> <span class="nc">MPChain</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class MPChain reading chains from MontePython output files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path to the the file where the chain is stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    
<div class="viewcode-block" id="MPChain.load">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPChain.load">[docs]</a>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the chain and automatically remove the non-markovian points.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># read the file to get the chain</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span>   <span class="o">=</span> <span class="o">-</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_total_n_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_length</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


        <span class="c1"># reread the file to find the non markovian part of the chain</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;update proposal&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>

            <span class="c1"># remove the non markovian part by default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span><span class="p">:]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_max_lnlkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span><span class="p">)</span>
        <span class="n">index_max_lnlkl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[:,</span> <span class="n">index_max_lnlkl</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_value</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="p">)</span></div>



<div class="viewcode-block" id="MPChain.remove_burnin">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPChain.remove_burnin">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_burnin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_max_lnlkl</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the burnin points according to the value of the maximum</span>
<span class="sd">        log likelihood over all chains. Only points of the chain that are </span>
<span class="sd">        after its overcrossing of global_max_lnlkl - 3 are kept.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        global_max_lnlkl : float</span>
<span class="sd">            Global maximum log likelihood over all chains</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">global_max_lnlkl</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">burnin_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span> <span class="o">&gt;=</span> <span class="n">global_max_lnlkl</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burnin_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span> <span class="o">=</span> <span class="n">burnin_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lnlkl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span><span class="p">:]</span></div>


        
<div class="viewcode-block" id="MPChain.values">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPChain.values">[docs]</a>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the values of the chain.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discard : int, optional</span>
<span class="sd">            Number of initial points to discard, by default 0.</span>
<span class="sd">        thin : int, optional</span>
<span class="sd">            Thining factor (taking only one value every value of thin), by default 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray with dimension (number of parameters, length of chain)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">discard</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;All points in chain &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span>  <span class="s2">&quot; discarded (discard &gt;= chain length)&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[:,</span> <span class="n">discard</span><span class="p">::</span><span class="n">thin</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="MPChain.compute_stats">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPChain.compute_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the mean and standard deviation within the chain.</span>
<span class="sd">        Should be called after `remove_burnin()`. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mean_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_value</span>  <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean_value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>



    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">markov_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markov_index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_lnlkl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_lnlkl</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">burnin_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burnin_index</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_fit</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_value</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_value</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of accepted steps not counting burnin and non markovian points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total number of accepted steps</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_length</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_n_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total number of steps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_n_steps</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of steps not counting burnin and non markovian points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acceptance_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">total_n_steps</span></div>





<div class="viewcode-block" id="Samples">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.Samples">[docs]</a>
<span class="k">class</span> <span class="nc">Samples</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class containing all chains of a MCMC analysis</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path to the chains.</span>
<span class="sd">    ids : list | np.ndarray | None, optional</span>
<span class="sd">        List of chains to take into accoung. If none all possible found chains are added. By default None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Samples.flat">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.Samples.flat">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">flat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">pass</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span>
    
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">pass</span></div>



<div class="viewcode-block" id="GaussianInfo">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.GaussianInfo">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GaussianInfo</span><span class="p">:</span>

    <span class="n">mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cov</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">param_names</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="GaussianInfo.compatible_with">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.GaussianInfo.compatible_with">[docs]</a>
    <span class="k">def</span> <span class="nf">compatible_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        
        <span class="n">all_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">param_names</span><span class="p">))</span> <span class="p">)</span>
       
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">all_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">param_names</span><span class="p">):</span>
                <span class="n">index_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">index_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">param_names</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">mean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">index_2</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="kc">False</span> 
                
        <span class="k">return</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="GaussianSamples">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.GaussianSamples">[docs]</a>
<span class="k">class</span> <span class="nc">GaussianSamples</span><span class="p">(</span><span class="n">Samples</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Daughter class of Samples for gaussian generated chains.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">gaussians</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">GaussianInfo</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">GaussianInfo</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">add_tau</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">*</span><span class="p">,</span> 
                 <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200_000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="o">=</span> <span class="n">add_tau</span>

        <span class="c1"># define a list of extra gaussian to add on top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span> <span class="o">=</span> <span class="n">gaussians</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">]</span>

        <span class="c1"># if given string input read the data</span>
        <span class="c1"># and check for compatibility between mean values</span>
        <span class="k">for</span> <span class="n">ig</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="n">ig</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="n">ig</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="n">ig</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">compatible_with</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="n">ig</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;fiducial parameters should agree&#39;</span><span class="p">)</span>

        <span class="c1"># parameters on that we will be contained </span>
        <span class="c1"># in the total covariance matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">)</span>

        <span class="c1"># get all the parameters in total</span>
        <span class="n">all_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">param_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_params</span><span class="p">:</span>
                    <span class="n">all_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># build a big inverse covariance matrix</span>
        <span class="c1"># that contains all parameters in the input</span>
        <span class="c1"># covariance matrices</span>
        <span class="n">all_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_params</span><span class="p">)</span>
        <span class="n">all_inv_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">all_n</span><span class="p">,</span> <span class="n">all_n</span><span class="p">))</span>
        <span class="n">all_mean</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">all_n</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussians</span><span class="p">:</span>
            <span class="n">this_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">param_names</span><span class="p">))</span>
            <span class="n">indices</span>     <span class="o">=</span> <span class="p">[</span><span class="n">all_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">this_params</span><span class="p">]</span>
            <span class="n">all_inv_cov</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">cov</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">mean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">all_mean</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">mean</span>


        <span class="c1"># select the part of the covariance matrix for the desired parameters</span>
        <span class="n">all_cov</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">all_inv_cov</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>  <span class="o">=</span> <span class="p">[</span><span class="n">all_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">]</span>

        <span class="c1"># construct a GaussianInfo object from the total cov and mean defined above</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gaussian</span>       <span class="o">=</span> <span class="n">GaussianInfo</span><span class="p">(</span><span class="n">all_mean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">],</span> <span class="n">all_cov</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">all_mean</span><span class="p">,</span> <span class="n">all_cov</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_all_params</span> <span class="o">=</span> <span class="n">all_params</span>

        <span class="c1"># add tau_ion as a parameter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;tau_reio&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">))</span>
        


<div class="viewcode-block" id="GaussianSamples.load_data">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.GaussianSamples.load_data">[docs]</a>
    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GaussianInfo</span><span class="p">:</span>

        <span class="n">gaussian</span> <span class="o">=</span> <span class="n">GaussianInfo</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">gaussian</span><span class="o">.</span><span class="n">cov</span>         <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">gaussian</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">gaussian</span><span class="o">.</span><span class="n">mean</span>        <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fiducial&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">mean</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gaussian</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gaussian</span></div>


        

<div class="viewcode-block" id="GaussianSamples.flat">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.GaussianSamples.flat">[docs]</a>
    <span class="k">def</span> <span class="nf">flat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">discard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">thin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thin</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">flat_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generated_data</span><span class="p">[:,</span> <span class="n">discard</span><span class="p">::</span><span class="n">thin</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">classifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">regressor</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">regressor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">regressor</span> <span class="o">=</span> <span class="n">Regressor</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">parameters_name</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_params</span><span class="p">:</span> <span class="c1"># only take from index 1 as tau is the zeroth</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_all_params</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                    <span class="n">val_range</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">parameters_range</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span>  <span class="n">flat_chain</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">val_range</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span>  <span class="p">(</span><span class="n">flat_chain</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">val_range</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>

            <span class="n">valid_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">flat_chain</span> <span class="o">=</span> <span class="n">flat_chain</span><span class="p">[:,</span> <span class="n">valid_columns</span><span class="p">]</span>

            <span class="n">tau</span> <span class="o">=</span> <span class="n">compute_tau</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_params</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">regressor</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">tau</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">flat_chain</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="p">:]))</span>

        <span class="k">return</span> <span class="n">flat_chain</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="p">:]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">}</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GaussianInfo</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gaussian</span></div>



<div class="viewcode-block" id="EMCEESamples">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.EMCEESamples">[docs]</a>
<span class="k">class</span> <span class="nc">EMCEESamples</span><span class="p">(</span><span class="n">Samples</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Daughter class of Samples for emcee chains.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">add_tau</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">EMCEE_IMPORTED</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot import emcee, therefore cannot work with emcee chains&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="o">=</span> <span class="n">add_tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_chains</span><span class="p">()</span>

        <span class="c1"># Check for convergence criterion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_converged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span>      <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_autocorr_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_converged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">emcee</span><span class="o">.</span><span class="n">autocorr</span><span class="o">.</span><span class="n">AutocorrError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_autocorr_time</span><span class="p">(</span><span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">pass</span>
        
        

<div class="viewcode-block" id="EMCEESamples.load_chains">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.EMCEESamples.load_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">load_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">HDFBackend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_theta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters_theta&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters_xi</span>    <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parameters_xi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xi</span>               <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_theta</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_xi</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;tau_reio&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_theta</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parameters_xi</span><span class="p">))</span></div>

        


<div class="viewcode-block" id="EMCEESamples.flat">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.EMCEESamples.flat">[docs]</a>
    <span class="k">def</span> <span class="nf">flat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        
        <span class="n">burnin_discard</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">discard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">thin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thin</span> <span class="o">=</span> <span class="mi">1</span>


        <span class="n">flat_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">burnin_discard</span> <span class="o">+</span> <span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="n">flat</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">flat_chain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xi</span><span class="p">,</span> <span class="p">(</span><span class="n">flat_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tau</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">classifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">regressor</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">compute_tau</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">regressor</span><span class="p">)</span>

            <span class="n">flat_chain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">tau</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">flat_chain</span><span class="p">))</span>
            
        <span class="k">return</span> <span class="n">flat_chain</span></div>


    

<div class="viewcode-block" id="EMCEESamples.convergence">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.EMCEESamples.convergence">[docs]</a>
    <span class="k">def</span> <span class="nf">convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_converged</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not converged yet&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span><span class="p">)</span></div>


        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">autocorr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autocorr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">}</span></div>



<div class="viewcode-block" id="save_sampling_parameters">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.save_sampling_parameters">[docs]</a>
<span class="k">def</span> <span class="nf">save_sampling_parameters</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                             <span class="n">parameters_theta</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                             <span class="n">parameters_xi</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                             <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> 
                 <span class="n">parameters_theta</span><span class="o">=</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">parameters_theta</span><span class="p">),</span> 
                 <span class="n">parameters_xi</span><span class="o">=</span><span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">parameters_xi</span><span class="p">),</span> 
                 <span class="n">xi</span><span class="o">=</span><span class="n">xi</span><span class="p">)</span></div>



<div class="viewcode-block" id="compute_tau">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.compute_tau">[docs]</a>
<span class="k">def</span> <span class="nf">compute_tau</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                <span class="n">param_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">classifier</span><span class="p">:</span> <span class="n">Classifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">regressor</span><span class="p">:</span> <span class="n">Regressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

      

        <span class="c1"># get the ordered list of parameters</span>
        <span class="k">if</span> <span class="n">regressor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">regressor</span>  <span class="o">=</span> <span class="n">Regressor</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">classifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="n">r_parameters</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">parameters_name</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">param_names</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;tau_reio&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">parameters</span> <span class="o">!=</span> <span class="s1">&#39;tau_reio&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s1">&#39;m_nu1&#39;</span>

            <span class="c1"># make a list of the given parameters that are needed for the interpolator</span>
            <span class="c1"># in the order they are</span>
            <span class="n">data_for_param</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                
                <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m_nu1&#39;</span>

                <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">r_parameters</span><span class="p">:</span>
                    <span class="n">data_for_param</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            
            <span class="c1"># get the data sample </span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">r_parameters</span><span class="p">),</span> <span class="n">flat_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 

            <span class="c1"># find the ordering in which data_sample is set in prepare_data_plot</span>
            <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">data_for_param</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r_parameters</span><span class="p">):</span> 
            
            <span class="c1"># if we ran the MCMC over that parameter</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">flat_chain</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">DEFAULT_VALUES</span><span class="p">[</span><span class="n">to_21cmFAST_names</span><span class="p">([</span><span class="n">param</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1">#return data </span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">predict_tau_numpy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">regressor</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tau</span></div>





<div class="viewcode-block" id="compute_parameter">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.compute_parameter">[docs]</a>
<span class="k">def</span> <span class="nf">compute_parameter</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                      <span class="n">param_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">classifier</span><span class="p">:</span> <span class="n">Classifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">interpolator</span><span class="p">:</span> <span class="n">Regressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">parameter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

        
        <span class="c1"># get the ordered list of parameters</span>
        <span class="k">if</span> <span class="n">interpolator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">interpolator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">interpolator</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;DefaultInterpolator_&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need to pass the parameter to interpolate to the predictor.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">classifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="c1"># parameters that the interpolator needs</span>
        <span class="n">i_parameters</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">interpolator</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">parameters_name</span><span class="p">)</span>

        <span class="c1"># parameters that are given in the sample</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">param_names</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># if tau_reio is given in the parameters we remove it</span>
        <span class="k">if</span> <span class="s1">&#39;tau_reio&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">flat_chain</span> <span class="o">=</span> <span class="n">flat_chain</span><span class="p">[</span><span class="n">parameters</span> <span class="o">!=</span> <span class="s1">&#39;tau_reio&#39;</span><span class="p">]</span> 
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">parameters</span> <span class="o">!=</span> <span class="s1">&#39;tau_reio&#39;</span><span class="p">]</span>
            

        <span class="c1"># make a list of the given parameters that are needed for the interpolator</span>
        <span class="c1"># in the order they are</span>
        <span class="n">data_for_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;m_nu1&#39;</span>

            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">i_parameters</span><span class="p">:</span>
                <span class="n">data_for_param</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        
        <span class="c1"># get the data sample </span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">i_parameters</span><span class="p">),</span> <span class="n">flat_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 

        <span class="c1"># find the ordering in which data_sample is set in prepare_data_plot</span>
        <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">data_for_param</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_parameters</span><span class="p">):</span> 
            
            <span class="c1"># if we ran the MCMC over that parameter</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">flat_chain</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">DEFAULT_VALUES</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">predict_parameter_numpy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span></div>





<div class="viewcode-block" id="MPSamples">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples">[docs]</a>
<span class="k">class</span> <span class="nc">MPSamples</span><span class="p">(</span><span class="n">Samples</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Daughter class of Samples for MontePython chains.</span>
<span class="sd">    &quot;&quot;&quot;</span>
 

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                 <span class="n">ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MPChain</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_chains</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_paramnames</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_lnlkl</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">max_lnlkl</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">])</span>
        <span class="n">chain_max_lnlkl</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">max_lnlkl</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_best_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">chain_max_lnlkl</span><span class="p">]</span><span class="o">.</span><span class="n">best_fit</span>

        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">:</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">remove_burnin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_lnlkl</span><span class="p">)</span>
        
        <span class="c1">#######################</span>
        <span class="c1"># print some results</span>

        <span class="n">max_markov_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">markov_index</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">]))))</span>
        <span class="n">max_burnin_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">burnin_index</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">]))))</span>
    
        <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Chain </span><span class="si">{</span><span class="n">ic</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">&lt;3</span><span class="si">}</span><span class="s1"> : Removed </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">markov_index</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">max_markov_index</span><span class="si">}}</span><span class="s1"> non-markovian points, &#39;</span> \
                  <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">burnin_index</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">max_burnin_index</span><span class="si">}}</span><span class="s1"> points of burn-in, keep &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                  <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; steps | (max_lnlkl = </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">max_lnlkl</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, acceptance_rate = </span><span class="si">{</span><span class="n">chain</span><span class="o">.</span><span class="n">acceptance_rate</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="p">)</span>
            
           
        <span class="c1">#######################</span>
        <span class="c1"># compute some stats</span>

        <span class="c1"># define some global quantities (total number of steps and overall mean of the parameters)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">chain</span><span class="o">.</span><span class="n">n_steps</span> <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">chain</span><span class="o">.</span><span class="n">compute_stats</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span> <span class="o">+</span> <span class="n">chain</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">*</span> <span class="n">chain</span><span class="o">.</span><span class="n">mean_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_steps</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_scaling_factor</span><span class="p">()</span>

           


<div class="viewcode-block" id="MPSamples.load_chains">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.load_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">load_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="c1"># look for chains in the folder</span>
        <span class="n">chains_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span>  <span class="s1">&#39;_*.txt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">chains_path</span><span class="p">))</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ids</span><span class="p">)]</span>

        <span class="c1"># raise an error if no chain is found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No chain found at &quot;</span> <span class="o">+</span> <span class="n">chains_path</span><span class="p">)</span>

        <span class="c1"># redefine the chain name list from the given ids</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">]</span>

        <span class="c1"># define the number of chains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">)</span>
        
        <span class="c1"># prepare an array for the non markovian chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># read all chains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span> <span class="o">=</span> <span class="p">[</span><span class="n">MPChain</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

        

<div class="viewcode-block" id="MPSamples.load_paramnames">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.load_paramnames">[docs]</a>
    <span class="k">def</span> <span class="nf">load_paramnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latex_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
       
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.paramnames&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latex_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latex_names</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span></div>



<div class="viewcode-block" id="MPSamples.load_scaling_factor">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.load_scaling_factor">[docs]</a>
    <span class="k">def</span> <span class="nf">load_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scaling_factor</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;log.param&#39;</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;data.parameters&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">name</span>  <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[] =&#39;&quot;</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[] =&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[] =&#39;&quot;</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_scaling_factor</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  </div>



<div class="viewcode-block" id="MPSamples.flat">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.flat">[docs]</a>
    <span class="k">def</span> <span class="nf">flat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flatten samples of all chains.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discard : np.ndarray | None, optional</span>
<span class="sd">            Number of points to discard at begining of the chain, by default None (0).</span>
<span class="sd">        thin : None | int, optional</span>
<span class="sd">            Reduce the size of the sample by taking one point every `thin`, by default None.</span>
<span class="sd">            If Nont compute the reduced size such that the total length of the sample is 10000.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Sample in a 2 dimensional array of shape (# of parameters, # of points)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">discard</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">discard</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">discard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">thin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_total_length</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">):</span>
                <span class="n">m_total_length</span> <span class="o">=</span> <span class="n">m_total_length</span> <span class="o">+</span> <span class="n">chain</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">discard</span> <span class="o">=</span> <span class="n">discard</span><span class="p">[</span><span class="n">ichain</span><span class="p">],</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">m_total_length</span> <span class="o">&gt;</span> <span class="mf">1e+4</span><span class="p">:</span>
                <span class="n">thin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m_total_length</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thin</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">res</span><span class="p">,</span> <span class="n">chain</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">discard</span> <span class="o">=</span> <span class="n">discard</span><span class="p">[</span><span class="n">ichain</span><span class="p">],</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>

    
    
<div class="viewcode-block" id="MPSamples.convergence">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.convergence">[docs]</a>
    <span class="k">def</span> <span class="nf">convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gelman-Rubin criterion weighted by the length of the chain as implemented</span>
<span class="sd">        in MontePython.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            R-1 for all parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">within</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)</span>
        <span class="n">between</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="p">:</span>
            <span class="n">within</span>  <span class="o">=</span> <span class="n">within</span>  <span class="o">+</span> <span class="n">chain</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">*</span> <span class="n">chain</span><span class="o">.</span><span class="n">var_value</span> 
            <span class="n">between</span> <span class="o">=</span> <span class="n">between</span> <span class="o">+</span> <span class="n">chain</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">*</span> <span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">mean_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">within</span>  <span class="o">=</span> <span class="n">within</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span>
        <span class="n">between</span> <span class="o">=</span> <span class="n">between</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">between</span><span class="o">/</span><span class="n">within</span></div>

    


<div class="viewcode-block" id="MPSamples.covmat">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.covmat">[docs]</a>
    <span class="k">def</span> <span class="nf">covmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
               <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
               <span class="n">params_in_cov</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Covariance matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        discard : np.ndarray | None, optional</span>
<span class="sd">            Number of points to discard at begining of the chain, by default None (0).</span>
<span class="sd">        data_to_cov : list[str] | None, optional</span>
<span class="sd">            List of parameters to put in the covariance matrix (in the order of that list).</span>
<span class="sd">            If None consider all parameters available.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Covariance matric (n, n) array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">points</span> <span class="o">=</span> <span class="n">prepare_data_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_in_cov</span><span class="p">,</span> <span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>





<div class="viewcode-block" id="MPSamples.print_best_fit">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.MPSamples.print_best_fit">[docs]</a>
    <span class="k">def</span> <span class="nf">print_best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">samples_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">med</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">samples_flat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples_flat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">):</span>
            <span class="n">nc</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="n">max_nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">):</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_nc</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">param</span> <span class="o">+</span>  <span class="n">fill</span> <span class="o">+</span> <span class="s1">&#39; : </span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_fit</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">med</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="n">ip</span><span class="p">]))</span></div>


     


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_lnlkl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_lnlkl</span>  
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_fit</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latex_names</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaling_factor</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_steps</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_mean</span></div>

    




<div class="viewcode-block" id="prepare_data_plot">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.prepare_data_plot">[docs]</a>
<span class="k">def</span> <span class="nf">prepare_data_plot</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Samples</span><span class="p">,</span> <span class="n">data_to_plot</span><span class="p">,</span> <span class="n">discard</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">)</span>

    <span class="c1"># give the transformation rules between the parameter if there is to be one</span>
    <span class="k">def</span> <span class="nf">transform_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">param_names</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;m_nu1&#39;</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">:</span>
                <span class="n">index_mnu</span> <span class="o">=</span> <span class="n">data_to_plot</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;sum_mnu&#39;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">index_mnu</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">neutrino_masses</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_mnu</span><span class="p">],</span> <span class="n">hierarchy</span><span class="o">=</span><span class="s1">&#39;NORMAL&#39;</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># change also the param_names</span>
                <span class="n">param_names</span><span class="p">[</span><span class="n">index_mnu</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Impossible to obtain &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; from the input data sample&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">param_names</span>


    <span class="n">data</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">flat</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">param_names</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">)</span>

    <span class="c1"># rescaling the data according to the scaling factor</span>
    <span class="k">for</span> <span class="n">iname</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;1/m_wdm&#39;</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;m_wdm&#39;</span><span class="p">):</span> 
            <span class="c1"># note that we keep the warm dark matter transformed</span>
            <span class="c1"># just means that we need to be carefull with the units</span>
            <span class="n">data</span><span class="p">[</span><span class="n">iname</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">iname</span><span class="p">]</span>


    <span class="c1"># first transform the data if necessary</span>
    <span class="k">if</span> <span class="s1">&#39;sum_mnu&#39;</span> <span class="ow">in</span> <span class="n">data_to_plot</span><span class="p">:</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">,</span> <span class="n">param_names</span><span class="p">)</span>


    <span class="c1"># reduce the data to the indices to plot</span>
    <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">param_names</span> <span class="o">==</span> <span class="n">param</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">data_to_plot</span> <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">]</span>

    <span class="c1"># remove outliers for tau_reio</span>
    <span class="k">if</span> <span class="s1">&#39;tau_reio&#39;</span> <span class="ow">in</span> <span class="n">data_to_plot</span><span class="p">:</span>
        <span class="n">index_tau_reio</span> <span class="o">=</span> <span class="n">data_to_plot</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;tau_reio&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">index_tau_reio</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
        <span class="n">n_outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">n_outliers</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removing </span><span class="si">{</span><span class="n">n_outliers</span><span class="si">}</span><span class="s1"> outlier points for tau_reio: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_tau_reio</span><span class="p">,</span> <span class="o">~</span><span class="n">mask</span><span class="p">]))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
        

    <span class="k">return</span> <span class="n">data</span></div>





<span class="c1">#################################################</span>
<span class="c1">## PLOTTING TOOLS</span>

<span class="n">MATPLOTLIB_IMPORTED</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mpc</span>

    <span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

    <span class="n">MATPLOTLIB_IMPORTED</span> <span class="o">=</span> <span class="kc">True</span>    

<div class="viewcode-block" id="AxesGrid">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid">[docs]</a>
    <span class="k">class</span> <span class="nc">AxesGrid</span><span class="p">:</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                    <span class="o">*</span><span class="p">,</span> 
                    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">wspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
                    <span class="n">hspace</span><span class="p">:</span> <span class="nb">float</span>  <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
                    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            
            <span class="c1"># close all pre-existing figures and disable interactive mode</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            
            <span class="c1"># define a figure object and the grid spec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="o">*</span><span class="n">n</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

            <span class="c1"># initialise the length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">n</span>

            <span class="c1"># initialise an empty list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))]</span>

            <span class="c1"># define the edges of the axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># define the labels of the axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;${{</span><span class="si">{}</span><span class="s1">}}_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\theta&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span> <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">labels</span>

            <span class="c1"># define the name of the parameter attached to each axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">names</span>

            <span class="c1"># define the titles of the axes (showing mean and quantiles if asked)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

            <span class="c1"># define the text objects holding the title</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Text</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>  

            <span class="c1"># define the axes on the grid</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                    <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_1D</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>


            <span class="c1"># define default font and rotation of ticks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ticks_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles_color</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_labels</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>



<div class="viewcode-block" id="AxesGrid.get">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.get">[docs]</a>
        <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>

            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_from_name</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_1D</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span></div>

        

<div class="viewcode-block" id="AxesGrid.index_1D">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.index_1D">[docs]</a>
        <span class="k">def</span> <span class="nf">index_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;j must be less or equal than i&quot;</span><span class="p">)</span> 

            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="AxesGrid.indices_2D">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.indices_2D">[docs]</a>
        <span class="k">def</span> <span class="nf">indices_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">ind_triangle</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">row</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">ind_triangle</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">column</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">ind_triangle</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span></div>



        <span class="c1"># show the plot</span>
<div class="viewcode-block" id="AxesGrid.show">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.show">[docs]</a>
        <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



        <span class="c1"># change one label name</span>
<div class="viewcode-block" id="AxesGrid.set_label">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.set_label">[docs]</a>
        <span class="k">def</span> <span class="nf">set_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



        <span class="c1"># update all the label properties</span>
<div class="viewcode-block" id="AxesGrid.update_labels">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.update_labels">[docs]</a>
        <span class="k">def</span> <span class="nf">update_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ticks_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ticks_rotation&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ticks_rotation</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_1D</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                        <span class="n">tick</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ticks_rotation</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_1D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                    <span class="n">tick</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ticks_rotation</span><span class="p">)</span></div>


        <span class="c1">#update the edges</span>
<div class="viewcode-block" id="AxesGrid.update_edges">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.update_edges">[docs]</a>
        <span class="k">def</span> <span class="nf">update_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">max</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_from_name</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">])</span> 

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span></div>

        

        <span class="c1"># update the titles properties</span>
<div class="viewcode-block" id="AxesGrid.add_title">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.add_title">[docs]</a>
        <span class="k">def</span> <span class="nf">add_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_titles</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles_color</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span> <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_titles</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="AxesGrid.update_titles">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.update_titles">[docs]</a>
        <span class="k">def</span> <span class="nf">update_titles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">spacing</span> <span class="o">=</span> <span class="mf">1.9</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontsize</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_1D</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">it</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_titles</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">total_height</span> <span class="o">=</span> <span class="n">height</span> <span class="k">if</span> <span class="n">it</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span><span class="o">+</span><span class="n">it</span><span class="o">*</span><span class="n">spacing</span><span class="o">*</span><span class="mf">1e-2</span><span class="o">*</span><span class="n">fontsize</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">total_height</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_titles_color</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_axs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">total_height</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_titles_text</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">it</span><span class="p">]</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span></div>


<div class="viewcode-block" id="AxesGrid.index_from_name">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.AxesGrid.index_from_name">[docs]</a>
        <span class="k">def</span> <span class="nf">index_from_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">na</span><span class="p">)</span> <span class="k">for</span> <span class="n">na</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span></div>


        <span class="c1"># List of properties</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span>
        
        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span>
        
        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
        
        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span>
        
        <span class="nd">@edges</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span> <span class="o">=</span> <span class="n">value</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span>
        
        <span class="nd">@labels</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_labels</span><span class="p">()</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span></div>



    
<div class="viewcode-block" id="ProcessedData">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.ProcessedData">[docs]</a>
    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">ProcessedData</span><span class="p">:</span>

        <span class="n">hists_1D</span>  <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hists_2D</span>  <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">edges</span>     <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">centers</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">levels</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">q</span>         <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">mean</span>      <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">median</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">bestfit</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">quantiles</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">samples</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">size</span>      <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>




<div class="viewcode-block" id="compute_quantiles">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.compute_quantiles">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_quantiles</span><span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give the q-th quantile of the input sample.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample : np.ndarray</span>
<span class="sd">            1D array of data points.</span>
<span class="sd">        q : float</span>
<span class="sd">            Quantile value.</span>
<span class="sd">        bins : int | np.ndarray, optional</span>
<span class="sd">            Binning of the histogram that is used </span>
<span class="sd">            for a first approximation of the quantile </span>
<span class="sd">            edges, by default 30.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        min,max bounds</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">split_in_groups</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
        
            <span class="n">res</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])]]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">il</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element</span> <span class="o">-</span> <span class="n">lst</span><span class="p">[</span><span class="n">il</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">element</span><span class="p">])</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>

            <span class="k">return</span> <span class="n">res</span>
            
        <span class="c1"># define the histogram from the sample</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">hist_count</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>

        <span class="c1"># normalise the histogram to 1</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>

        <span class="c1"># define the total sum of the histogram</span>
        <span class="n">s_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>

        <span class="c1"># order the histogram values</span>
        <span class="n">ordered_hist</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">hist</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">order_of_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">hist</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># compute the cumulative sum and get all indices that</span>
        <span class="c1"># contribute to the quantile</span>
        <span class="n">sum_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ordered_hist</span><span class="p">)</span><span class="o">/</span><span class="n">s_hist</span> 
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)[</span><span class="n">sum_hist</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">]</span>

        <span class="c1"># the first bin is already high enough we return its boundaries</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

            <span class="n">index_one</span> <span class="o">=</span> <span class="n">order_of_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">e_min</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index_one</span><span class="p">]</span>
            <span class="n">e_max</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index_one</span><span class="p">]</span>
            <span class="n">e_min</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">index_one</span><span class="p">]</span>
            <span class="n">e_max</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">index_one</span><span class="p">]</span>

            <span class="n">ilg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_count_small</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># add an extra index to be sure we capture all the good bins</span>
            <span class="n">final_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># if we have same size hist values where sum_hist = q then</span>
            <span class="c1"># we need to consider all possible bins that can contribute</span>
            <span class="c1"># we put all these indices into a table</span>
            <span class="n">multiple_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">final_index</span><span class="p">]</span>

            <span class="k">while</span> <span class="n">final_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_hist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ordered_hist</span><span class="p">[</span><span class="n">final_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">ordered_hist</span><span class="p">[</span><span class="n">final_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">multiple_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">final_index</span> <span class="o">=</span> <span class="n">final_index</span><span class="o">+</span><span class="mi">1</span>

            <span class="c1"># chack for each last index what is the one that minimize the number of groups </span>
            <span class="n">len_groups</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">multiple_indices</span><span class="p">:</span>
                <span class="n">bin_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order_of_hist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])))])</span> <span class="c1"># all bins contributing</span>
                <span class="n">len_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_in_groups</span><span class="p">(</span><span class="n">bin_indices</span><span class="p">)))</span>

            <span class="n">index_min_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">len_groups</span><span class="p">)</span>
            <span class="n">bin_indices</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order_of_hist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">multiple_indices</span><span class="p">[</span><span class="n">index_min_groups</span><span class="p">]])))])</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">split_in_groups</span><span class="p">(</span><span class="n">bin_indices</span><span class="p">)</span>


            <span class="c1"># here size is different from length,</span>
            <span class="c1"># size refers to the &#39;physical&#39; size</span>
            <span class="n">size_groups</span>   <span class="o">=</span> <span class="p">[]</span>
            <span class="n">count_groups</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sample_groups</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># get what is inside the groups</span>
            <span class="c1"># approximate values of the other groups</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

            <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">ig</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">index_min</span><span class="p">,</span> <span class="n">index_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                
                <span class="n">e_max</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_max</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index_max</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">index_max</span><span class="p">]</span>
                <span class="n">e_min</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_min</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index_min</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">index_min</span><span class="p">]</span>

                <span class="n">size_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e_max</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">e_min</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
                <span class="n">count_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hist_count</span><span class="p">[</span><span class="n">group</span><span class="p">])))</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;</span> <span class="n">e_min</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&lt;</span> <span class="n">e_max</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">sample_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

                <span class="n">x_min</span><span class="p">[</span><span class="n">ig</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_min</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">x_max</span><span class="p">[</span><span class="n">ig</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_max</span><span class="p">[</span><span class="n">ig</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># adjust the exact value for the largest group</span>
                <span class="c1"># and keep only the bins of the smaller groups</span>


            <span class="n">ilg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">size_groups</span><span class="p">)</span>
            <span class="n">total_count_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">count_groups</span><span class="p">)</span> <span class="o">-</span> <span class="n">count_groups</span><span class="p">[</span><span class="n">ilg</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">sample_groups</span><span class="p">[</span><span class="n">ilg</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>


        <span class="c1"># define the grid for the finner search</span>
        <span class="n">x_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">e_min</span><span class="p">[</span><span class="n">ilg</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_min</span><span class="p">[</span><span class="n">ilg</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">x_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">e_max</span><span class="p">[</span><span class="n">ilg</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_max</span><span class="p">[</span><span class="n">ilg</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">30</span><span class="p">)</span>


        <span class="c1"># for each value of x_m find the value of x_p such that quantile is q</span>
        <span class="n">mask</span>  <span class="o">=</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;=</span> <span class="n">x_m</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&lt;=</span>  <span class="n">x_p</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">total_count_small</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">m_x_p</span> <span class="o">=</span> <span class="n">x_p</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">q</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">:</span>
            <span class="n">x_min</span><span class="p">[</span><span class="n">ilg</span><span class="p">],</span> <span class="n">x_max</span><span class="p">[</span><span class="n">ilg</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span>

        <span class="c1"># remove the values where x_p is just equal to the max</span>
        <span class="c1"># at the very edege of the grid </span>
        <span class="n">mask_xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">m_x_p</span> <span class="o">!=</span> <span class="n">x_p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># if we have removed all points then problem</span>
        <span class="c1"># we actually do not mask, it is just that we</span>
        <span class="c1"># cannot really find the q contour with our</span>
        <span class="c1"># resolution. Return the max value</span>
        <span class="k">if</span> <span class="n">mask_xp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_min</span><span class="p">[</span><span class="n">ilg</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x_max</span><span class="p">[</span><span class="n">ilg</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xm</span>  <span class="o">=</span> <span class="n">x_m</span><span class="p">[:</span><span class="n">mask_xp</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">xp</span>  <span class="o">=</span> <span class="n">m_x_p</span><span class="p">[:</span><span class="n">mask_xp</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span> <span class="o">-</span> <span class="n">xm</span> <span class="o">-</span> <span class="n">xp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">x_min</span><span class="p">[</span><span class="n">ilg</span><span class="p">],</span> <span class="n">x_max</span><span class="p">[</span><span class="n">ilg</span><span class="p">]</span> <span class="o">=</span> <span class="n">xm</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">xp</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span></div>






<div class="viewcode-block" id="generate_contours">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.generate_contours">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_contours</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                        <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
                        <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span>
                        <span class="n">smooth_2D</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">smooth_1D</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">sigma_smooth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,)</span> <span class="o">-&gt;</span> <span class="n">ProcessedData</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">ProcessedData</span><span class="p">()</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">hists_1D</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">))</span>
        <span class="n">hists_2D</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">bins</span><span class="p">))</span>    <span class="c1"># 2D array of 2D array</span>
        <span class="n">levels</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 2D array of 1D array</span>

        <span class="n">quantiles</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">q</span> <span class="o">!=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;levels should be given in ascending order&#39;</span><span class="p">)</span>
            <span class="c1"># check that the input levels are in ascending order</span>

        <span class="c1"># edges and centers of the histograms</span>
        <span class="n">edges</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">bins</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">])</span>
        <span class="n">centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">edges</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">mean</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>


        <span class="c1"># loop over all places with 1D histograms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            
            <span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth_1D</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># evaluate the quantiles</span>
            <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">q_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">compute_quantiles</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">q_val</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible to compute quantiles for entry </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_min</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_max</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quantiles not given for what appears to be a multimodal distribution </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">quantiles</span><span class="p">[</span><span class="n">il</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">quantiles</span><span class="p">[</span><span class="n">il</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="n">il</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">quantiles</span><span class="p">[</span><span class="n">il</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>

        
        <span class="c1"># loop over all places with 2D histograms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>

                <span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth_2D</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                
                <span class="c1"># Flatten the histogram to sort for cumulative density</span>
                <span class="n">sorted_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Sort in descending order</span>

                <span class="c1"># Compute cumulative density</span>
                <span class="n">cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sorted_hist</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sorted_hist</span><span class="p">)</span>

                <span class="c1"># Find threshold levels for the desired confidence intervals</span>
                <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_hist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative</span><span class="p">,</span> <span class="n">q</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sorted_hist</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">hists_2D</span>  <span class="o">=</span> <span class="n">hists_2D</span>
        <span class="n">data</span><span class="o">.</span><span class="n">hists_1D</span>  <span class="o">=</span> <span class="n">hists_1D</span>
        <span class="n">data</span><span class="o">.</span><span class="n">samples</span>   <span class="o">=</span> <span class="n">samples</span>
        <span class="n">data</span><span class="o">.</span><span class="n">edges</span>     <span class="o">=</span> <span class="n">edges</span>
        <span class="n">data</span><span class="o">.</span><span class="n">centers</span>   <span class="o">=</span> <span class="n">centers</span>
        <span class="n">data</span><span class="o">.</span><span class="n">levels</span>    <span class="o">=</span> <span class="n">levels</span>
        <span class="n">data</span><span class="o">.</span><span class="n">mean</span>      <span class="o">=</span> <span class="n">mean</span>
        <span class="n">data</span><span class="o">.</span><span class="n">median</span>    <span class="o">=</span> <span class="n">median</span>
        <span class="n">data</span><span class="o">.</span><span class="n">quantiles</span> <span class="o">=</span> <span class="n">quantiles</span>
        <span class="n">data</span><span class="o">.</span><span class="n">size</span>      <span class="o">=</span> <span class="n">hists_1D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">q</span>         <span class="o">=</span> <span class="n">q</span>
            
        <span class="k">return</span> <span class="n">data</span></div>




<div class="viewcode-block" id="plot_data">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.plot_data">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="n">AxesGrid</span><span class="p">,</span> 
                <span class="n">data</span> <span class="p">:</span> <span class="n">ProcessedData</span><span class="p">,</span> 
                <span class="n">show_hist</span><span class="p">:</span> <span class="nb">bool</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                <span class="n">show_surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                <span class="n">show_contour</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">show_quantiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                <span class="n">show_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">show_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">show_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">redefine_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">q_in_title</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.68</span><span class="p">,</span>
                <span class="n">colors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                <span class="n">axes</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">exclude_quantiles</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="n">exclude_mean</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="n">exclude_title</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="n">alphas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        

        <span class="n">alphas</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">exclude_quantiles</span><span class="p">,</span> <span class="n">exclude_mean</span><span class="p">,</span> <span class="n">exclude_title</span> <span class="o">=</span> <span class="p">([</span><span class="n">array</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">array</span> <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="p">[</span><span class="n">alphas</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">exclude_quantiles</span><span class="p">,</span> <span class="n">exclude_mean</span><span class="p">,</span> <span class="n">exclude_title</span><span class="p">])</span>
        <span class="n">exclude_quantiles</span><span class="p">,</span> <span class="n">exclude_mean</span><span class="p">,</span> <span class="n">exclude_title</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">index_from_name</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exclude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span> <span class="k">else</span> <span class="n">exclude</span> <span class="k">for</span> <span class="n">exclude</span> <span class="ow">in</span> <span class="p">[</span><span class="n">exclude_quantiles</span><span class="p">,</span> <span class="n">exclude_mean</span><span class="p">,</span> <span class="n">exclude_title</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>


        <span class="c1"># first define the colors we will need to use</span>
        <span class="n">contour_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpc</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">ic</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">color</span> <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>

        <span class="c1"># if we provide one color and we ask for more levels then</span>
        <span class="c1"># we define new colors automatically colors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contour_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="n">pastelness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pastelness</span> <span class="o">=</span> <span class="n">pastelness</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">pastelness</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># add custom pastel colors to the stack of colors</span>
            <span class="n">contour_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pastelness</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contour_colors</span><span class="p">)</span> <span class="o">+</span> <span class="n">pastelness</span><span class="p">,</span> <span class="n">contour_colors</span><span class="p">))</span>
            
        <span class="c1"># plot the contours and points</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>

                <span class="n">hist</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">show_points</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

                    <span class="c1"># first thin the samples so that we plot only 5000 points</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">5000</span><span class="p">)])</span>

                    <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">::</span><span class="n">r</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">::</span><span class="n">r</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">contour_colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


                <span class="k">if</span> <span class="n">show_hist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

                
                <span class="k">if</span> <span class="n">show_surface</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">contour_colors</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error for axis : &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>

                <span class="k">if</span> <span class="n">show_contour</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">contour_colors</span><span class="p">)</span>


        
        <span class="c1"># fill in the 1D histograms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            
            <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">stairs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">edges</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">show_mean</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_mean</span><span class="p">):</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">contour_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">iq</span><span class="p">,</span> <span class="n">quantile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">quantiles</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">show_quantiles</span><span class="p">[</span><span class="n">iq</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_quantiles</span><span class="p">):</span>

                    <span class="c1"># fill the histogram in terms of the first quantile</span>
                    <span class="n">mask_edges</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">quantile</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">quantile</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># corresponding mask for the histogram values</span>
                    <span class="n">mask_hist</span>  <span class="o">=</span> <span class="p">(</span><span class="n">mask_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">mask_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">mask_hist</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># plot the quantiles with a shaded histogram</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">stairs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hists_1D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">mask_hist</span><span class="p">],</span> <span class="n">edges</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">mask_edges</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">contour_colors</span><span class="p">[</span><span class="n">iq</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        
            <span class="n">title_color</span> <span class="o">=</span> <span class="n">contour_colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">title_color</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="c1"># get the number of quantiles</span>
            <span class="k">if</span> <span class="n">q_in_title</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
                <span class="n">jq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q_in_title</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">q</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;quantile in title should be a q value given in generate_contour&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">show_title</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_title</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">quantiles</span><span class="p">[</span><span class="n">jq</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">quantiles</span><span class="p">[</span><span class="n">jq</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                    <span class="n">grid</span><span class="o">.</span><span class="n">add_title</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:.3g}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;$^{{ +</span><span class="si">{:.2g}</span><span class="s1"> }}_{{ -</span><span class="si">{:.2g}</span><span class="s1"> }}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">quantiles</span><span class="p">[</span><span class="n">jq</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">quantiles</span><span class="p">[</span><span class="n">jq</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">title_color</span><span class="p">)</span>  
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grid</span><span class="o">.</span><span class="n">add_title</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:.3g}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">title_color</span><span class="p">)</span> 
        
        
        <span class="n">grid</span><span class="o">.</span><span class="n">update_titles</span><span class="p">()</span>


        <span class="c1"># (re)define the grid edges</span>
        <span class="k">if</span> <span class="n">redefine_edges</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="n">new_boundaries</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

            <span class="n">old_boundaries</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">]</span>
            <span class="n">old_boundaries</span><span class="p">[</span><span class="n">old_boundaries</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">old_boundaries</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:][:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

            <span class="n">new_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">new_boundaries</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">old_boundaries</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> 
            <span class="n">new_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">new_boundaries</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">old_boundaries</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">new_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">new_min</span><span class="p">,</span> <span class="n">new_max</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new_edges</span> 
            
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                    <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                    
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">grid</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span></div>





<div class="viewcode-block" id="plot_2D_marginal">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.plot_2D_marginal">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_2D_marginal</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
                        <span class="n">data</span> <span class="p">:</span> <span class="n">ProcessedData</span><span class="p">,</span> 
                        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">show_hist</span><span class="p">:</span> <span class="nb">bool</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                        <span class="n">show_surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                        <span class="n">show_contour</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">show_points</span><span class="p">:</span> <span class="nb">bool</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">colors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> 
                        <span class="n">alphas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        


        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span>

        <span class="n">hist</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hists_2D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    

        <span class="n">alphas</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">([</span><span class="n">array</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">array</span> <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="p">[</span><span class="n">alphas</span><span class="p">,</span> <span class="n">colors</span><span class="p">])</span>

        <span class="c1"># first define the colors we will need to use</span>
        <span class="n">contour_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpc</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">ic</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">color</span> <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>

        <span class="c1"># if we provide one color and we ask for more levels then</span>
        <span class="c1"># we define new colors automatically colors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contour_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="n">pastelness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pastelness</span> <span class="o">=</span> <span class="n">pastelness</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">pastelness</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># add custom pastel colors to the stack of colors</span>
            <span class="n">contour_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pastelness</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contour_colors</span><span class="p">)</span> <span class="o">+</span> <span class="n">pastelness</span><span class="p">,</span> <span class="n">contour_colors</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">show_points</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># first thin the samples so that we plot only 5000 points</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">10000</span><span class="p">)])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">::</span><span class="n">r</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">::</span><span class="n">r</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">contour_colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_hist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

                
        <span class="k">if</span> <span class="n">show_surface</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">hist</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">contour_colors</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error for axis : &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">show_contour</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">hist</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">contour_colors</span><span class="p">)</span></div>


        



<div class="viewcode-block" id="prepare_data_Xe">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.prepare_data_Xe">[docs]</a>
    <span class="k">def</span> <span class="nf">prepare_data_Xe</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Samples</span><span class="p">,</span> 
                    <span class="n">data_to_plot</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>  
                    <span class="n">discard</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                    <span class="n">thin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">,</span>
                    <span class="n">classifier</span><span class="p">:</span> <span class="n">Classifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">regressor</span><span class="p">:</span> <span class="n">Regressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
        
        <span class="n">data_for_Xe</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">to_CLASS_names</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">)</span>

        <span class="c1"># get the ordered list of parameters</span>
        <span class="k">if</span> <span class="n">regressor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">regressor</span>  <span class="o">=</span> <span class="n">Regressor</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">classifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">parameters_name</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">data_to_plot</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;sum_mnu&#39;</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s1">&#39;m_nu1&#39;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">param</span> <span class="ow">in</span> <span class="n">MP_KEY_CORRESPONDANCE</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MP_KEY_CORRESPONDANCE</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">):</span>
                <span class="n">data_for_Xe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        
        <span class="n">labels_correspondance</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span> <span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">MP_KEY_CORRESPONDANCE</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
        <span class="c1"># get the data sample </span>
        <span class="n">data_sample</span> <span class="o">=</span> <span class="n">prepare_data_plot</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">data_for_Xe</span><span class="p">,</span> <span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="n">regressor</span> <span class="o">=</span> <span class="n">regressor</span><span class="p">,</span> <span class="n">classifier</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">),</span> <span class="n">data_sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 

        <span class="c1"># find the ordering in which data_sample is set in prepare_data_plot</span>
        <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">param_names</span> <span class="o">==</span> <span class="n">param</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">data_for_Xe</span> <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span> 
            
            <span class="c1"># if we ran the MCMC over that parameter</span>
            <span class="k">if</span> <span class="n">labels_correspondance</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">[</span><span class="n">indices_to_plot</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">labels_correspondance</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_sample</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">DEFAULT_VALUES</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data</span></div>

        


<div class="viewcode-block" id="get_Xe_stats">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.get_Xe_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">get_Xe_stats</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Samples</span><span class="p">,</span> 
                    <span class="n">data_to_plot</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>  
                    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                    <span class="n">discard</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                    <span class="n">thin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">,</span>
                    <span class="n">classifier</span><span class="p">:</span> <span class="n">Classifier</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">regressor</span><span class="p">:</span> <span class="n">Regressor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">smooth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">sigma_smooth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">prepare_data_Xe</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">data_to_plot</span><span class="p">,</span> <span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="p">,</span> <span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span> <span class="n">regressor</span><span class="o">=</span><span class="n">regressor</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">regressor</span><span class="o">.</span><span class="n">parameters_name</span><span class="p">:</span>
                <span class="n">ikw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">parameters_name</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="n">ikw</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need to pass a kwarg that is in the parameter list of the classifier / regressor&quot;</span><span class="p">)</span>

        <span class="n">Xe</span> <span class="o">=</span> <span class="n">predict_Xe_numpy</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span> <span class="n">regressor</span><span class="o">=</span><span class="n">regressor</span><span class="p">)</span>

        <span class="c1"># here remove some outliers that should not have </span>
        <span class="c1"># passed the likelihood condition</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">Xe</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Xe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;More than 1 percent of outliers with late reionization&quot;</span><span class="p">)</span>

        <span class="n">Xe</span> <span class="o">=</span> <span class="n">Xe</span><span class="p">[</span><span class="n">Xe</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">z</span>
        
        <span class="n">mean</span><span class="p">,</span> <span class="n">med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Xe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">Xe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Xe</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Xe</span><span class="p">)</span>

        <span class="n">log_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">min</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">log_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">lin_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">lin_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lin_bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># make an histogram for each value of z</span>
        <span class="k">for</span> <span class="n">iz</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Xe</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>

            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">log_bins</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span>
            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">])</span>
            
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">lin_bins</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span>
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">])</span>
        
        <span class="n">log_bins</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">log_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">lin_bins</span> <span class="o">=</span> <span class="p">(</span><span class="n">lin_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lin_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span>
        
        <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">log_hist</span><span class="p">,</span> <span class="n">log_bins</span><span class="p">,</span> <span class="n">lin_hist</span><span class="p">,</span> <span class="n">lin_bins</span></div>





<div class="viewcode-block" id="get_Xe_tanh_stats">
<a class="viewcode-back" href="../../source/nnero.analysis.html#nnero.analysis.get_Xe_tanh_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">get_Xe_tanh_stats</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Samples</span><span class="p">,</span> 
                            <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                            <span class="n">discard</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                            <span class="n">thin</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                            <span class="n">x_inf</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e-4</span><span class="p">,</span> 
                            <span class="o">*</span><span class="p">,</span>
                            <span class="n">smooth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">sigma_smooth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">Xe_class</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z_reio</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span>  <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z_reio</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z_reio</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">))</span>   <span class="p">)</span> <span class="p">)</span>   

        <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">param_names</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;z_reio&#39;</span><span class="p">)</span>
        <span class="n">z_reio</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">flat</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">Xe</span> <span class="o">=</span> <span class="n">Xe_class</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z_reio</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">+</span> <span class="n">x_inf</span>

        <span class="n">mean</span><span class="p">,</span> <span class="n">med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Xe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">Xe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Xe</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Xe</span><span class="p">)</span>

        <span class="n">log_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">min</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">log_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">lin_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">lin_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lin_bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># make an histogram for each value of z</span>
        <span class="k">for</span> <span class="n">iz</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Xe</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>

            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">log_bins</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span>
            <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">])</span>
            
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">lin_bins</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_smooth</span><span class="p">)</span> <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span>
            <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lin_hist</span><span class="p">[</span><span class="n">iz</span><span class="p">])</span>
        
        <span class="n">log_bins</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">log_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">lin_bins</span> <span class="o">=</span> <span class="p">(</span><span class="n">lin_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lin_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span>
        
        <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">log_hist</span><span class="p">,</span> <span class="n">log_bins</span><span class="p">,</span> <span class="n">lin_hist</span><span class="p">,</span> <span class="n">lin_bins</span></div>

    
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ga√©tan Facchinetti.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>